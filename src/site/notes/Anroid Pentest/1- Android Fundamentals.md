---
{"dg-publish":true,"permalink":"/anroid-pentest/1-android-fundamentals/","created":"2025-06-09T19:22:19.922+03:00","updated":"2025-06-09T22:03:32.248+03:00"}
---

# About Android

Android, telefon ve tablet gibi dokunmatik ekranlı cihazlar için oluşturulmuş bir mobil işletim sistemidir. Linux Kernel'in değiştirilmiş bir versiyonuna dayanan bu işletim sistemi Open Handset Alliance konsorsiyumu tarafından geliştirilmiş ve Google tarafından ticari olarak desteklenmiştir. Çoğu Android cihaz, Google Play ve Google Chrome gibi uygulamaları içeren tescilli bir yazılım paketi olan Google Mobile Services (GMS) ile önceden yüklenmiş olarak gelir. Google, kullanıcı arayüzlerinin ve yazılım özelliklerinin özelleştirilmesine izin vermek için Samsung ve HTC gibi çeşitli satıcılarla işbirliği yapmaktadır. Akıllı telefonlar ve tabletlerin ötesinde, Android işletim sistemi Google tarafından geliştirilen akıllı TV'lerde ve taşınabilir cihazlarda da kullanılmaktadır. Android uygulamaları Google Play Store, Amazon Appstore, Samsung Galaxy Store, Huawei AppGallery gibi çeşitli uygulama mağazaları ve Aptoide, F-Droid, APKPure ve APKMirror gibi açık kaynak platformları aracılığıyla dağıtılmaktadır.

## History

Ekim 2003'te Andy Rubin, Rich Miner, Nick Sears ve Chris White, Palo Alto, Kaliforniya'da Android Incorporated'ı kurdu. Rubin'in yatırımcı çekme çabalarının ardından 2005 yılında Google şirketi yaklaşık 50 milyon dolar karşılığında satın aldı. Bir süre sonra Rubin'in Google'daki ekibi Linux kernel tarafından desteklenen ilk mobil cihazı geliştirdi. 2007 yılında dokunmatik ekranı ve fiziksel QWERTY klavyesi olmayan erken bir prototip oluşturuldu ve bunu HTC Dream (Eylül 2008'de piyasaya sürülen ilk ticari Android cihazı olan T-Mobile G1 olarak da bilinir) izledi. Android'in 10. sürümden önceki ana sürümleri tatlıların isimlerini almıştır. Örneğin, ilk Android sürümleri `Cupcake`, `Donut`, `Eclair` ve `Froyo` olarak adlandırılmıştır.

2010 yılında Google Nexus serisini piyasaya sürdü ve Mayıs 2013'te Samsung Galaxy S4'ün Google Play içeren özel bir sürümünü, ardından HTC One Google Play sürümünü ve Moto G Google Play sürümünü duyurdu. Haziran 2014'te Google, üçüncü taraf üreticilerin kolayca ve düşük maliyetle yüksek kaliteli akıllı telefonlar üretmesini sağlamayı amaçlayan bir program olan Android One'ı tanıttı. Ekim 2016'da Google, Nexus serisini tamamen Google tarafından tasarlanan ve pazarlanan ilk telefonlar olan Pixel ve Pixel XL akıllı telefonlarla değiştirdi. 3 Eylül 2019'da Google, Pixel cihazları için Android 10'u (başlangıçta Android Q olarak anılacaktır) piyasaya sürdü ve büyük Android sürümlerine tatlıların adını verme geleneğini resmen sona erdirdi.


## Versions

Aşağıda Android kod adları, sürümleri, API seviyeleri ve yayınlanma tarihleri arasındaki ilişkiyi gösteren bir tablo yer almaktadır.

|**Name**|**Version**|**API Level**|**Release Date**|
|---|---|---|---|
|Android 1.0|1.0|1|September 23, 2008|
|Android 1.1|1.1|2|February 9, 2009|
|Android Cupcake|1.5|3|April 27, 2009|
|Android Donut|1.6|4|September 15, 2009|
|Android Eclair|2.0|5|October 27, 2009|
|Android Eclair|2.0.1|6|December 3, 2009|
|Android Eclair|2.1|7|January 11, 2010|
|Android Froyo|2.2 – 2.2.3|8|May 20, 2010|
|Android Gingerbread|2.3 – 2.3.2|9|December 6, 2010|
|Android Gingerbread|2.3.3 – 2.3.7|10|February 9, 2011|
|Android Honeycomb|3.0|11|February 22, 2011|
|Android Honeycomb|3.1|12|May 10, 2011|
|Android Honeycomb|3.2 – 3.2.6|13|July 15, 2011|
|Android Ice Cream Sandwich|4.0 – 4.0.2|14|October 18, 2011|
|Android Ice Cream Sandwich|4.0.3 – 4.0.4|15|December 16, 2011|
|Android Jelly Bean|4.1 – 4.1.2|16|July 9, 2012|
|Android Jelly Bean|4.2 – 4.2.2|17|November 13, 2012|
|Android Jelly Bean|test|18|July 24, 2013|
|Android KitKat|4.4 – 4.4.4|19|October 31, 2013|
|Android KitKat|4.4W – 4.4W.2|20|June 25, 2014|
|Android Lollipop|5.0 – 5.0.2|21|November 4, 2014|
|Android Lollipop|5.1 – 5.1.1|22|March 2, 2015|
|Android Marshmallow|6.0 – 6.0.1|23|October 2, 2015|
|Android Nougat|7.0|24|August 22, 2016|
|Android Nougat|7.1 – 7.1.2|25|October 4, 2016|
|Android Oreo|8.0|26|August 21, 2017|
|Android Oreo|8.1|27|December 5, 2017|
|Android Pie|9|28|August 6, 2018|
|Android 10|10|29|September 3, 2019|
|Android 11|11|30|September 8, 2020|
|Android 12|12|31|October 4, 2021|
|Android 12L|12.1|32|March 7, 2022|
|Android 13|13|33|August 15, 2022|
|Android 14|14|34|October 4, 2023|
|Android 15|15|35|September 3, 2024|
|Android 16|16 Beta|36|March 13, 2025|

Cihazın Android sürümü, diğer bilgilerle birlikte `Settings` (Ayarlar) -> `About emulated device` (Taklit cihaz hakkında) -> `Android version` (Android sürümü) altında bulunabilir.

![Pasted image 20250609192742.png](/img/user/Pasted%20image%2020250609192742.png)


## Hardware

Android bir dizi donanım mimarisini desteklese de, cihazların çoğu ARM (AArch64) mimarisini kullanmaktadır. X86 ve x86-64 gibi mimariler de, özellikle Intel işlemcileri içeren sonraki Android sürümlerinde desteklenmiştir. Resmi olmayan Android-x86 projesi, Android tarafından resmi olarak desteklenmeden önce bile x86 mimarisi için destek sağlamıştır. x86 gibi local olmayan mimariler de SDK ile birlikte gelen Android Emülatöründe ve çeşitli üçüncü taraf emülatörlerde çalışabilir. Android cihazlar tipik olarak video kameralar, GPS, oryantasyon sensörleri, özel oyun kontrolleri, ivmeölçerler, jiroskoplar, barometreler, manyetometreler, yakınlık sensörleri, basınç sensörleri, termometreler ve dokunmatik ekranlar gibi çeşitli donanım bileşenleri içerir. 


Soru : Android cihazların çoğunda kullanılan birincil donanım mimarisi nedir?

cevap : `ARM`


# Android Operating System

Önceki bölümde bahsettiğimiz gibi, Android Linux Tabanlı bir işletim sistemidir ve birisi cihaz üzerinde bir shell'e erişim sağladığında, Linux komutları çalıştırılabilir. İlerleyen bölümlerde göreceğimiz gibi Linux shell, kullanıcılar ve sistem kerneli arasında text tabanlı bir I/O (giriş/çıkış) arayüzü sağlayacaktır. Aşağıdaki örnek dosya sisteminde nasıl gezinileceğini ve `/sdcard/` dizininin içeriğinin nasıl listeleneceğini göstermektedir.


#### Android Shell

```shell-session
emu64x:/ # cd /sdcard/
emu64x:/sdcard # ls -l

total 104
drwxrws--- 2 u0_a143  media_rw 4096 2022-12-28 11:48 Alarms
drwxrws--x 5 media_rw media_rw 4096 2022-12-28 11:47 Android
drwxrws--- 2 u0_a143  media_rw 4096 2022-12-28 11:48 Audiobooks
drwxrws--- 2 u0_a143  media_rw 4096 2022-12-28 11:48 DCIM
drwxrws--- 2 u0_a143  media_rw 4096 2022-12-28 11:48 Documents
drwxrws--- 2 u0_a143  media_rw 4096 2023-04-19 01:18 Download
drwxrws--- 3 u0_a143  media_rw 4096 2022-12-28 11:48 Movies
drwxrws--- 3 u0_a143  media_rw 4096 2022-12-28 11:48 Music
drwxrws--- 2 u0_a143  media_rw 4096 2022-12-28 11:48 Notifications
drwxrws--- 4 u0_a143  media_rw 4096 2022-12-30 15:09 Pictures
drwxrws--- 2 u0_a143  media_rw 4096 2022-12-28 11:48 Podcasts
drwxrws--- 2 u0_a143  media_rw 4096 2022-12-28 11:48 Recordings
drwxrws--- 2 u0_a143  media_rw 4096 2022-12-28 11:48 Ringtones
```


## Android Software Stack

Android platformu, aşağıdaki paragraflarda analiz edeceğimiz altı bileşenden oluşmaktadır. Aşağıdaki resim, Android'in kullandığı ve bu bileşenleri içeren Linux tabanlı yazılım stack'ini göstermektedir.

![Pasted image 20250609210356.png](/img/user/Pasted%20image%2020250609210356.png)

[Platform architecture](https://developer.android.com/guide/platform)

#### Linux Kernel

Linux kernel Android platformunun temelidir ve ekran, kamera, bluetooth, wifi, ses, USB ve daha fazlası gibi cihaz donanımlarının yönetiminden sorumludur. Android Runtime da thread ve bellek yönetimi gibi işlevleri yerine getirmek için bu katmana dayanır.

Ek olarak, Linux kernel Android'in çok sayıda güvenlik özelliğinden (“user-based permissions model” ve “process isolation” gibi) faydalanmasını sağlar:

| **Kernel-Level Security Features**                                                    |
| ------------------------------------------------------------------------------------- |
| Kullanıcıların birbirlerinin dosyalarını okumasını önleyin.                           |
| Kullanıcıların birbirlerinin hafızasını tüketmesini önleyin.                          |
| Kullanıcıların CPU kaynaklarını tüketmesini önleyin.                                  |
| Kullanıcıların telefon, GPS ve Bluetooth gibi cihaz kaynaklarını tüketmesini önleyin. |

#### Hardware Abstraction Layer (HAL)

Hardware Abstraction Layer (HAL), Android işletim sistemine kameralar, Bluetooth, sensörler ve giriş cihazları gibi donanım bileşenleriyle etkileşim için standartlaştırılmış bir arayüz sağlayan bir yazılım katmanıdır. Donanım ve üst düzey yazılım katmanları arasında bir köprü görevi gören HAL, yazılımın donanım özelliklerine erişiminde tutarlılık sağlar. Farklı donanım bileşenleri benzersiz gereksinimlere ve yeteneklere sahip olabileceğinden, cihazlar arasında çalışan taşınabilir yazılım yazmak zor olabilir. HAL, donanıma özgü uygulama ayrıntılarını Android framework'ten izole ederek bu sorunu çözer. Çalışma zamanında Android framework tarafından dinamik olarak yüklenen bir paylaşılan kütüphaneler koleksiyonu olarak uygulanmaktadır. Bu mimari, cihaz üreticilerinin daha geniş Android platformuyla uyumluluğu korurken donanımları için özel destek uygulamalarına olanak tanır.


#### Android Runtime

Android Runtime (ART), Android işletim sistemi tarafından uygulamaları yürütmek için kullanılan yönetilen runtime ortamıdır. Dalvik virtual machine'in yerine Android 5.0 Lollipop'ta tanıtılan ART, uygulama yürütmeye önemli mimari iyileştirmeler getirmiştir. ART ve Dalvik arasındaki temel fark derleme stratejilerinde yatmaktadır: ART, Ahead-of-Time (AOT) derlemesini kullanırken, Dalvik Just-in-Time (JIT) derlemesine dayanmaktadır. AOT ile uygulama kodu yükleme sırasında native makine koduna derlenir, bu da daha hızlı uygulama başlatma süreleri ve gelişmiş çalışma zamanı performansı sağlar.

ART, düşük bellekli cihazlarda bile birden fazla virtual machine'i eş zamanlı olarak çalıştırabilir ve DEX (Dalvik Executable) formatında paketlenmiş uygulamaları çalıştırır. Daha da önemlisi ART, orijinal olarak Dalvik için oluşturulmuş uygulamalarla geriye dönük uyumluluğu korur. Android Runtime'ın temel özelliklerinden ve avantajlarından bazıları şunlardır:


| **ART Features**                              |
| --------------------------------------------- |
| Geliştirilmiş garbage collection.             |
| Daha iyi bellek yönetimi.                     |
| Daha iyi debug desteği.                       |
| DEX dosyasının optimize edilmiş sıkıştırması. |

#### Native C/C++ Libraries

Native C/C++ Libraries bileşeni, C ve C++ programlama dillerinde yazılmış bir dizi kütüphanedir ve Android işletim sistemine dahildir. Developerlar genellikle bu kütüphaneleri yüksek performans elde etmek ya da donanımla doğrudan etkileşime geçmek için düşük seviyeli kod yazmak amacıyla kullanırlar. Güvenliği artırmak için hardening teknikleri de local C++ kodu kullanılarak uygulanabilir.

ART ve HAL gibi Android bileşenleri native kod kullanılarak oluşturulur ve bu bileşenlerin çalışması için native kütüphanelere erişim gerekir. Uygulamalar bu kütüphanelere Java Native Interface (JNI) aracılığıyla erişebilirken, programcılar native kütüphanelere doğrudan kendi native kodlarından erişmek için Android NDK'yı kullanabilirler.


#### Java API Framework

Android platform mimarisinin bir diğer önemli parçası da Java API Framework'tür. Bu bileşen, Android uygulamaları oluşturmak için yazılım araçları ve arayüzleri sağlar. Aşağıda Java API Framework'ün sağladığı bileşenlerden bazıları verilmiştir.

| **Components** (Bileşenler) |
| --------------------------- |
| View System                 |
| Resource Manager            |
| Notification Manager        |
| Activity Manager            |
| Content Providers           |
| Location Manager            |
| Package Manager             |


#### System Apps

System Apps, platform mimarisinin en üst katman temel bileşenidir. Bu bileşen, Android işletim sistemiyle birlikte gelen tüm önceden yüklenmiş uygulamaları içerir. Bu tür uygulamalar şunları içerir:

|**Apps**|
|---|
|Contacts|
|Messaging|
|Camera|
|Browser|
|Calendar|
|Maps|
|Settings|

Önceden yüklenmiş uygulamalar yalnızca root edilmiş cihazlarda değiştirilebilir. Ancak, geliştiriciler sağlanan API'leri kullanarak bunları uygulamalarında kullanabilirler. Örneğin, bir geliştirici QR kodu taramak için kamerayı kullanan bir uygulama oluşturabilir.


## Dalvik VM

Dalvik Virtual Machine (DVM) Google tarafından geliştirilmiş ve 2008 yılında Android'in ilk sürümüyle birlikte kullanıma sunulmuştur. Java veya Kotlin ile yazılmış Android uygulamaları Java bayt koduna derlenir ve ardından Dalvik bayt koduna dönüştürülerek .dex (Dalvik Executable) veya .odex (Optimized Dalvik Executable) dosya formatlarında paketlenir. Stack tabanlı olan Java Sanal Makinesi'nin (JVM) aksine, Dalvik VM register tabanlı bir virtual machine'dir. Bu mimari fark, mobil ortamlar için ideal olan sınırlı CPU ve bellek kaynaklarına sahip cihazlarda daha verimli yürütme sağlar.

Dalvik, API seviyesi 21'den (Lollipop) önceki Android sürümlerinde varsayılan runtime ortamıydı. Sonunda yerini Android 4.4'te (KitKat) önizleme olarak sunulan ve Android 5.0'da varsayılan hale gelen Android Runtime (ART) aldı. ART, Dalvik ile aynı .dex bytecode formatını kullanarak uyumluluğu korur, ancak yürütme modelinde önemli ölçüde farklılık gösterir. Dalvik Just-in-Time (JIT) derlemesini kullanırken, ART başlangıçta Ahead-of-Time (AOT) derlemesini kullandı - bytecode'u yükleme sırasında native makine koduna derleyerek daha hızlı başlatma ve gelişmiş performans sağladı. Daha sonraki Android sürümlerinde ART, hibrit JIT + AOT ve Profile Guided Optimizations (PGO) içerecek şekilde gelişerek çalışma zamanı verimliliğini ve pil performansını daha da artırdı.


## Rooting

Android, flash depolama alanını aşağıdaki iki ana bölüme ayırır.

- `/system/`
- `/data/`

`/system/` partition'ı işletim sistemi tarafından, `/data/` partition'ı ise kullanıcı verileri ve uygulama kurulumları için kullanılır. Android'de kullanıcıların işletim sistemine root erişimi yoktur ve bazı bölümler (`/system/` gibi) `read-only`'dir . Ancak, güvenlik açıklarından yararlanarak cihazın root edilmesi sağlanabilir. Root edilmiş bir cihaza sahip olmak, cihazın yeteneklerini ve özelleştirilebilirliğini artırır ve debugging ve genel güvenlik değerlendirmelerine yardımcı olur. Root işlemi işletim sisteminin bazı built-in güvenlik özelliklerini devre dışı bıraktığından, rootlu Android cihazlar kötü niyetli virüslere ve zararlı yazılımlara karşı daha hassastır. Google Pixel ve OnePlus gibi bazı modellerde root işlemi, OEM Kilit Açma seçeneği aracılığıyla bootloader kilidini açarak da gerçekleştirilebilir.

## Important Directories

| Dizin                             | Açıklama                                                                                                                             |
| --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `/data/data`                      | Kullanıcı tarafından yüklenen tüm uygulamaların bulunduğu dizindir.                                                                  |
| `/data/user/0`                    | Sadece uygulamanın erişebileceği verilere ev sahipliği yapar.                                                                        |
| `/data/app`                       | Kullanıcı tarafından yüklenen uygulamaların APK dosyalarını içerir.                                                                  |
| `/system/app`                     | Cihaza önceden yüklenmiş (pre-installed) uygulamaları içerir.                                                                        |
| `/system/bin`                     | Binary dosyalarını içerir.                                                                                                           |
| `/data/local/tmp`                 | Yazılabilir (world-writable) bir dizindir.                                                                                           |
| `/data/system`                    | Sistem yapılandırma (configuration) dosyalarını içerir.                                                                              |
| `/etc/apns-conf.xml`              | Varsayılan **Access Point Name (APN)** yapılandırmalarını içerir. APN, cihazın mevcut operatör ağına bağlanabilmesi için kullanılır. |
| `/data/misc/wifi`                 | WiFi yapılandırma dosyalarını içerir.                                                                                                |
| `/data/misc/user/0/cacerts-added` | Kullanıcı sertifika deposudur. Kullanıcı tarafından eklenen sertifikaları içerir.                                                    |
| `/etc/security/cacerts/`          | Sistem sertifika deposudur. Root olmayan kullanıcılar için erişim izni yoktur.                                                       |
| `/sdcard`                         | DCIM, Downloads, Music, Pictures gibi dizinlere sembolik bağlantı (symbolic link) içerir.                                            |

Soru : Android Runtime ve Dalvik VM ne tür dosyaları çalıştırır?

Cevap : `dex`

---

# Android Security Özellikleri

Kotlin ve Java, Android uygulamaları geliştirmek için kullanılan iki temel dildir. Android SDK araçları, uygulama kaynak kodunu kaynak dosyaları ve varlıklarla birlikte bir Android Paketi (APK) halinde derler. APK, derlenmiş bayt kodu (`.dex`), menifest meta verileri, kaynaklar ve native kütüphaneler dahil olmak üzere bir Android uygulamasını yüklemek ve çalıştırmak için gereken tüm bileşenleri içeren `.apk` uzantılı bir arşiv dosyasıdır.

Her Android uygulaması, altta yatan Linux tabanlı mimari tarafından uygulanan kendi izole güvenlik sandbox'ı içinde çalışır. Bu sandboxing modeli birkaç temel Android güvenlik özelliği tarafından desteklenmektedir:

| **Security Features**                                                                                                                                                                                                                                                                |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Android, her uygulamanın ayrı bir kullanıcı olarak değerlendirildiği çmulit-user bir Linux sistemidir.                                                                                                                                                                               |
| Varsayılan olarak, sistem her uygulamaya benzersiz bir Linux kullanıcı kimliği (UID) atar. Bu UID sistem tarafından erişim kontrolü için kullanılır, ancak uygulamanın kendisine açık değildir.                                                                                      |
| File system permission'leri yalnızca belirli bir UID'ye atanmış uygulamanın kendi dosyalarına erişebilmesini sağlar.                                                                                                                                                                 |
| Her uygulama kendi prosesinde çalışır ve her proses Android Runtime (ART) virtual machine'in ayrı bir instance'ında çalışarak bellek izolasyonunu sağlar.                                                                                                                            |
| Sistem, uygulamanın prosesini gerektiği gibi başlatır ve artık gerekli olmadığında veya sistem kaynaklarını geri kazanırken sonlandırır.                                                                                                                                             |
| Android en az ayrıcalık prensibini uygular, yani uygulamalar yalnızca temel işlevlerini yerine getirmek için gerekli izinleri alır. Ek ayrıcalıklar uygulamanın manifestosunda açıkça belirtilmeli ve kullanıcı (veya API seviyesine bağlı olarak sistem) tarafından onaylanmalıdır. |

## Application Sandbox

Android, her uygulamaya benzersiz bir user ID (UID) atayarak ve kendi prosesinde çalıştırarak uygulamaları izole etmek için Linux'un kullanıcı tabanlı güvenlik modelini kullanır. Bu, uygulamalar ve sistem arasında katı sınırlar uygulayan ve uygulama sınırları boyunca yetkisiz veri erişimini veya kod yürütmeyi önleyen kernel düzeyinde bir uygulama sandbox'ı oluşturur. Açık izinler verilmediği sürece uygulamalar birbirleriyle etkileşime giremez veya ayrıcalıklarının ötesinde sistem kaynaklarına erişemez. Korumalı alan Linux kerneli tarafından uygulandığından, bu korumalar native binary'ler, OS servisleri, kütüphaneler ve kullanıcı uygulamaları da dahil olmak üzere kernel üzerinde çalışan tüm kodlar için aynı şekilde geçerlidir. Bu korumalı alandan kaçmak, genellikle bir privilege escalation exploiti yoluyla kernelin kendisinin tehlikeye atılmasını gerektirir.

![Pasted image 20250609214205.png](/img/user/Pasted%20image%2020250609214205.png)


Aşağıdaki komutu çalıştırdığımızda, tüm uygulamaların farklı bir UID'ye sahip olduğunu görebiliriz.

#### Android Shell

```shell-session
root:/# ls -l /data/data/

<SNIP>
drwx------  4 system         system         4096 2022-12-28 11:47 android
drwx------  4 bluetooth      bluetooth      4096 2022-12-28 11:47 com.android.bluetooth
drwx------  5 radio          radio          4096 2022-12-28 11:48 com.android.ons
drwx------  5 shell          shell          4096 2022-12-28 11:49 com.android.shell
drwx------ 11 u0_a114        u0_a114        4096 2022-12-30 12:41 com.android.chrome
drwx------  5 u0_a119        u0_a119        4096 2022-12-28 11:49 com.android.camera2
```

Android'in kullandığı UID tabanlı isteğe bağlı access control (DAC) sandboxing'e ek olarak, uygulama ve sistem izolasyonunu güçlendirmek için birçok başka koruma da getirilmiştir. Aşağıdaki korumalar önceki Android sürümlerinde tanıtılmıştır.

| **Additional Protections**                                                                                                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------- |
| SELinux Mandatory Access Control (MAC): Sistemi uygulamalardan ayırır.                                                                            |
| SELinux sandbox extension: Uygulamaları fiziksel kullanıcılar arasında izole eder.                                                                |
| Filtre `seccomp-bpf`: Uygulamaların kullanmasına izin verilen `syscalls` için bir sınır belirler.                                                 |
| Bireysel SELinux sandbox'ları ve Mandatory Access Control (MAC): `targetSdkVersion >= 28` ile ayrıcalıklı olmayan tüm uygulamalar için mevcuttur. |
| Dosya sisteminin sınırlı raw görünümü: `sdcard/DCIM` gibi yollara doğrudan erişim yok.                                                            |
Uygulamalar arasında dosya paylaşımı da güçlü güvenlik uygulamaları ve uygulama gerektirir. `targetSdkVersion >= 28`'den bu yana uygulama verilerinin dünya çapında erişilebilir olarak ayarlanmasına, istenen alıcının belirtilememesi nedeniyle izin verilmemektedir ve bu nedenle kötü niyetli uygulamalar diğer uygulamalardan hassas bilgilere erişim sağlayabilir.


## Application Signing

Bir uygulamayı bir cihaza yüklemek veya Play Store'a yüklemek için APK dosyasının imzalanması gerekir. APK'nın imzalanması, paketi zararlı değişikliklerden koruduğu için güvenlik açısından çok önemlidir. Android 7.0 ve önceki sürümleri çalıştıran cihazlar JAR imzalamayı (v1) destekler, ancak bu yöntem tam koruma sağlamaz; APK'nın ZIP meta verileri gibi belirli bölümleri imza kapsamında değildir.

Signature Scheme v2, APK bütünlüğünü iyileştirmek ve yetkisiz değişikliklere karşı koruma sağlamak için Android 7.0 ve sonrasında kullanıma sunulmuştur. Android 9'da tanıtılan Signature Scheme v3, imzalama bloğuna ek meta veriler dahil etme desteği ekledi. Android 11'den itibaren APK'nın tüm baytları üzerinden hesaplanan bir Merkle hash tree kullanan ve bir fs-verity hash tree yapısını takip eden APK İmza Şeması v4 kullanılmaktadır. v4 imzası ayrı bir dosyada saklanır ve karşılık gelen bir v2 veya v3 imzası gerektirir. Aşağıdaki resim, bir uygulama yüklendiğinde imza doğrulama akışını göstermektedir.

![Pasted image 20250609214843.png](/img/user/Pasted%20image%2020250609214843.png)
  

Signature v2 ve v3, herhangi bir değişiklik varsa APK dosyasını geçersiz kılan kontroller gerçekleştirir. Bu şekilde DEX dosyalarının APK dosyasına enjekte edilmesi gibi saldırılar engellenir. Ancak Signature Scheme v1 bu tür saldırılara karşı savunmasızdır. Janus güvenlik açığı (CVE-2017-13156), APK'nın Signature Scheme v1 kullanılarak imzalandığı durumlarda kötü niyetli kişilerin imzaları etkilemeden DEX dosyalarını APK'ya enjekte etmesine olanak tanır. Sonuç olarak, değiştirilmiş uygulamayı yükleyebilir ve çalıştırabilirler.

Malicious DEX dosyası APK dosyasına eklenir ve Android runtime bunu uygulamanın önceki, legal versiyonuna yapılmış geçerli bir güncelleme olarak kabul eder. Ardından, Dalvik VM DEX dosyasının kodunu yükleyecektir. Signature Scheme v1 kullanılarak imzalanan 5.0 < 8.1 Android cihazlar Janus'tan etkilenir.

Uygulama imzalama çeşitli şekillerde gerçekleştirilebilir:

| **Signing Ways**                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Android Studio, `Generate Signed App Bundle / APK` oluşturma seçeneği aracılığıyla.                                                                                                                                                                                                                                                                                                                                                                                                          |
| `jarsigner` / `apksigner` araçları.                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| [Play App Signing](https://support.google.com/googleplay/android-developer/answer/9842756?sjid=14772812161089830777-NC#zippy=%2Cwhat-is-play-app-signing%2Cwhy-should-i-use-play-app-signing%2Chow-does-play-app-signing-work%2Cwhat-are-the-benefits-of-using-play-app-signing%2Cwhat-are-the-requirements-for-using-play-app-signing%2Chow-do-i-enroll-in-play-app-signing%2Cwhat-happens-if-i-cancel-my-play-app-signing-subscription%2Cwhat-if-i-have-questions-about-play-app-signing). |

Bir uygulamayı imzalamak için kullanılan sertifikalar kendinden imzalıdır. Aşağıdaki komutlar kullanılarak `apksigner` aracı (Signature Scheme v4) ile bir APK dosyası imzalanabilir:

#### Signing an APK File

```shell-session
C4RT3L@htb[/htb]$ echo -e "password\npassword\njohn doe\ntest\ntest\ntest\ntest\ntest\nyes" > params.txt
C4RT3L@htb[/htb]$ cat params.txt | keytool -genkey -keystore key.keystore -validity 1000 -keyalg RSA -alias john
C4RT3L@htb[/htb]$ zipalign -p -f -v 4 myapp.apk myapp_signed.apk
C4RT3L@htb[/htb]$ echo password | apksigner sign --ks key.keystore myapp_signed.apk
```

Bu komutlar bizim için aşağıdakileri gerçekleştirir:

| **APK Signing Steps**                                                                                                                                                                                                          |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `keytool`'un bir keypair oluşturması için gerekli input verilerini içeren bir `params.txt` dosyası oluşturur.                                                                                                                  |
| `Key.keystore`'da key'i saklayarak key oluşturma işlemini otomatikleştirmek için `params.txt`'nin içeriğini `keytool`'a aktarır.                                                                                               |
| `zipalign`, `myapp.apk` içindeki ziplenmemiş dosyalara doğrudan [mmap](https://man7.org/linux/man-pages/man2/mmap.2.html) aracılığıyla erişilmesini sağlayarak `myapp_signed.apk` adlı optimize edilmiş bir uygulama oluşturur |
| Final uygulaması `apksigner` ile `key.keystore`'da saklanan key ve pipe üzerinden echo edilen şifre kullanılarak imzalanır                                                                                                     |

## Verified Boot

Verified Boot, işletim sisteminin bütünlüğünü sağlayan bir Android güvenlik özelliğidir. Bu, boot image'i imzalamak ve doğrulamak için benzersiz bir kriptografik key seti kullanılarak elde edilir ve sadece yetkili tarafların sistemi değiştirebilmesini sağlar. Android açılırken, her aşama bir sonraki aşamanın bütünlüğünü ve gerçekliğini doğrular ve imza geçerliyse cihaz normal şekilde açılır. Aksi takdirde, cihaz ya açılmaz ya da kullanıcıya cihazın kurcalandığını bildiren bir mesaj gönderir. Bunun dışında, Verified Boot, güvenlik açıklarının kalıcı hale gelmesini önlemek için Rollback Protection'ı kullanır. Bu, Android'in yalnızca en yeni sürümlere güncellenmesini sağlayarak yapılır. Bir cihaz için önerilen boot akışı aşağıdaki gibidir:

![Pasted image 20250609220012.png](/img/user/Pasted%20image%2020250609220012.png)

Sorulara geçmeden önce, `Android Studio` ve `Android Emülatörleri` -> `Android Studio AVD` bölümlerinde verilen adımları izlediğinizden ve virtaul bir Android cihazı kurduğunuzdan emin olun. Bu cihaz, modülün geri kalanında ve daha sonra sorulacak sorularda kullanılacaktır.

Soru : Hangi Signature Scheme sürümleri CVE-2017-13156'ya karşı savunmasızdır? (Biçim: 3 kelime)

Cevap : `Signature Scheme v1`